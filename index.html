<!DOCTYPE html>
<html lang="zh-tw">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台鐵時刻表JSON公開資料線上轉換鐵路運行圖程式 ver 0.1</title>
    <link rel="stylesheet" href="css/style.css">

    <style>
        #myProgress {
            position: relative;
            width: 30%;
            height: 30px;
            background-color: #ddd;
        }

        #myBar {
            position: absolute;
            width: 0%;
            height: 100%;
            background-color: #4CAF50;
        }

        #label {
            text-align: center;
            line-height: 30px;
            color: white;
        }
    </style>

</head>

<body>
    <h1>台鐵時刻表JSON公開資料線上轉換鐵路運行圖程式 <span>ver 0.1</span></h1>
    <p><a href="https://ods.railway.gov.tw/tra-ods-web/ods/download/dataResource/railway_schedule/JSON/list">台鐵時刻表JSON公開資料下載</a></p>
    <p>本網站繪製的運行圖均來自台鐵公開資料或使用者自行產生的資料所繪製，並非實際鐵路運作實況，僅供參考，正確資料與實際運轉狀況請以台鐵網站或公告為主。</p>
    <input type="file" id="file_input" accept=".json">
    <input id="train_no" placeholder="你可以選擇特定車次號" type="text">
    <select id="line_kind"></select>
    <button onclick="processFile()">台鐵JSON轉檔</button>
    <hr>

    <!-- <div id="myProgress">
        <div id="myBar">
            <div id="label">0%</div>
        </div>
    </div> -->

   
</body>

<script src="js/svg.js/svg.min.js" defer></script>
<script src="js/environment.js" defer></script>
<script src="js/batch.js" defer></script>
<script src="js/diagram.js" defer></script>

<script>
    function processFile() {
        const elements = document.querySelectorAll("svg");
        elements.forEach(function (element) {
            element.remove();
        });

        const file_input = document.getElementById("file_input");
        const train_no = document.getElementById("train_no").value;
        const line_kind = document.getElementById("line_kind").value;
        const file = file_input.files[0];

        const reader = new FileReader();
        reader.onload = function (event) {
            const contents = event.target.result;
            const data = JSON.parse(contents);

            process_json(data, train_no, line_kind);
        };
        reader.readAsText(file);
    }

    // 取得父元素
    const parentElement = document.getElementById("line_kind");
    const selections = {
    "LINE_WN": "西部幹線北段(基隆-竹南)",
    "LINE_WM": "西部幹線台中線(竹南-彰化，經苗栗)",
    "LINE_WSEA": "西部幹線海岸線(竹南-彰化，經大甲)",
    "LINE_WS": "西部幹線南段(彰化-高雄)",
    "LINE_P": "屏東線(高雄-枋寮)",
    "LINE_S": "南迴線(枋寮-台東)",
    "LINE_T": "台東線(花蓮-台東)",
    "LINE_N": "北迴線(蘇澳新-花蓮)",
    "LINE_I": "宜蘭線(八堵-蘇澳)",
    "LINE_PX": "平溪深澳線(八斗子-菁桐)",
    "LINE_LJ": "內灣線(新竹-內灣)",
    "LINE_NW": "六家線(新竹-六家)",
    "LINE_J": "集集線(二水-車埕)",
    "LINE_SL": "沙崙線(中洲-沙崙)"
    }

    // 建立要新增的子元素
    Object.entries(selections).forEach(([key, value]) => {
        const childElement = document.createElement("option");
        childElement.textContent = value;
        childElement.setAttribute('value', key);

        // 將子元素新增到父元素中
        parentElement.appendChild(childElement);
    })
</script>

</html>